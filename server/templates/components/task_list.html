{% if tasks.is_empty() %}
<div class="card">
    <p class="text-secondary">No tasks running.</p>
</div>
{% else %}
<div class="card">
    <table>
        <thead>
            <tr>
                <th>Task</th>
                <th>Plugin</th>
                <th>Server</th>
                <th>Schedule</th>
                <th>Last Run</th>
                <th>Next Run</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td>
                    <strong>{{ task.name }}</strong>
                    {% match task.description %}
                    {% when Some with (d) %}
                    <br><small class="text-secondary">{{ d }}</small>
                    {% when None %}
                    {% endmatch %}
                </td>
                <td>{{ task.plugin_id }}</td>
                <td>
                    {% match task.server_name %}
                    {% when Some with (name) %}
                    <span class="badge">{{ name }}</span>
                    {% when None %}
                    <span class="badge badge-primary">Local</span>
                    {% endmatch %}
                </td>
                <td><code>{{ task.schedule }}</code></td>
                <td>
                    {% match task.last_run_at %}
                    {% when Some with (t) %}{{ t }}{% when None %}<span class="text-secondary">Never</span>{% endmatch %}
                </td>
                <td>
                    {% match task.next_run_at %}
                    {% when Some with (t) %}{{ t }}{% when None %}<span class="text-secondary">-</span>{% endmatch %}
                </td>
                <td>
                    <button class="btn btn-sm btn-primary"
                            hx-post="/tasks/{{ task.id }}/run"
                            hx-target="#task-run-result-{{ task.id }}"
                            hx-swap="innerHTML">
                        â–¶ Run Now
                    </button>
                    <div id="task-run-result-{{ task.id }}"></div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

