{% if servers.is_empty() %}
<div class="card">
    <p class="text-secondary">No servers configured yet. Click "Add Server" to get started.</p>
</div>
{% else %}
<div class="grid grid-2">
    {% for server in servers %}
    <div class="card" id="server-{{ server.id }}">
        <div class="card-header">
            <h3 class="card-title">{{ server.name }}</h3>
            <span class="badge {% if server.enabled %}badge-success{% else %}badge-warning{% endif %}">
                {% if server.enabled %}Enabled{% else %}Disabled{% endif %}
            </span>
        </div>

        <p class="text-secondary">
            <strong>Host:</strong> {{ server.host }}{% match server.port %}{% when Some with (p) %}:{{ p }}{% when None %}{% endmatch %}<br>
            {% match server.credential %}
            {% when Some with (c) %}
            <strong>Credential:</strong> {{ c.name }} ({{ c.username }})<br>
            {% when None %}
            <strong>User:</strong> {% match server.username %}{% when Some with (u) %}{{ u }}{% when None %}(not set){% endmatch %}<br>
            {% endmatch %}
            {% match server.description %}
            {% when Some with (d) %}
            <strong>Description:</strong> {{ d }}<br>
            {% when None %}
            {% endmatch %}
        </p>

        <!-- Tags -->
        {% if !server.tags.is_empty() %}
        <div class="flex gap-1 mb-2 flex-wrap">
            {% for tag in server.tags %}
            <span class="badge" style="background-color: {{ tag.color }}; color: #fff;">
                {{ tag.name }}
            </span>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Capabilities -->
        {% if !server.capabilities.is_empty() %}
        <div class="text-secondary mb-2">
            <strong>Capabilities:</strong>
            <div class="flex gap-1 flex-wrap mt-1">
                {% for cap in server.capabilities %}
                <span class="badge badge-info" style="font-size: 0.75rem;">
                    <i data-lucide="{% match cap %}
                        {% when svrctlrs_database::models::ServerCapability::Docker %}package
                        {% when svrctlrs_database::models::ServerCapability::Systemd %}activity
                        {% when svrctlrs_database::models::ServerCapability::AptGet %}download
                        {% when svrctlrs_database::models::ServerCapability::Dnf %}download
                        {% when svrctlrs_database::models::ServerCapability::Yum %}download
                        {% endmatch %}" style="width: 10px; height: 10px;"></i>
                    {% match cap %}
                    {% when svrctlrs_database::models::ServerCapability::Docker %}Docker
                    {% when svrctlrs_database::models::ServerCapability::Systemd %}systemd
                    {% when svrctlrs_database::models::ServerCapability::AptGet %}apt
                    {% when svrctlrs_database::models::ServerCapability::Dnf %}dnf
                    {% when svrctlrs_database::models::ServerCapability::Yum %}yum
                    {% endmatch %}
                </span>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="flex gap-2 mt-2">
            <button hx-get="/servers/{{ server.id }}/edit"
                    hx-target="#server-form-container"
                    hx-swap="innerHTML"
                    class="btn btn-sm btn-secondary">
                <i data-lucide="pencil" style="width: 14px; height: 14px;"></i> Edit
            </button>

            <button hx-post="/servers/{{ server.id }}/detect-capabilities"
                    hx-target="#server-{{ server.id }}"
                    hx-swap="outerHTML"
                    class="btn btn-sm btn-secondary">
                <i data-lucide="radar" style="width: 14px; height: 14px;"></i> Detect
            </button>

            <button hx-delete="/servers/{{ server.id }}"
                    hx-target="#server-{{ server.id }}"
                    hx-swap="outerHTML"
                    hx-confirm="Delete server '{{ server.name }}'?"
                    class="btn btn-sm btn-danger">
                <i data-lucide="trash-2" style="width: 14px; height: 14px;"></i> Delete
            </button>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}
