<div class="card">
    <h2>Configure {{ plugin.name }}</h2>
    
    {% match error %}
    {% when Some with (e) %}
    <div class="alert alert-error">{{ e }}</div>
    {% when None %}
    {% endmatch %}
    
    <form hx-put="/plugins/{{ plugin.id }}/config"
          hx-target="#plugin-config-container"
          hx-swap="innerHTML">
        
        <p class="text-secondary mb-3">{{ plugin.description }}</p>
        
        <!-- Schedule configuration (common to all plugins) -->
        <div class="form-group">
            <label for="schedule">Schedule (Cron Expression)</label>
            <input type="text" 
                   id="schedule" 
                   name="schedule" 
                   value="{{ config_schedule }}"
                   placeholder="0 */5 * * * * (every 5 minutes)"
                   pattern="^(\S+\s+){5}\S+$"
                   title="Enter a valid cron expression (6 fields: second minute hour day month weekday)">
            <small class="text-secondary">Format: second minute hour day month weekday. Example: 0 30 5 * * * (daily at 5:30 AM)</small>
        </div>
        
        <!-- Dynamic configuration fields based on plugin type -->
        {% if plugin.id == "weather" %}
            <div class="form-group">
                <label for="api_key">OpenWeatherMap API Key *</label>
                <input type="text" 
                       id="api_key" 
                       name="api_key" 
                       value="{{ config_api_key }}"
                       placeholder="Enter your API key"
                       required>
                <small class="text-secondary">Get your free API key from <a href="https://openweathermap.org/api" target="_blank">OpenWeatherMap</a></small>
            </div>
            
            <div class="form-group">
                <label for="zip">ZIP Code (Optional - Takes Priority)</label>
                <input type="text" 
                       id="zip" 
                       name="zip" 
                       value="{{ config_zip }}"
                       placeholder="52726,US">
                <small class="text-secondary">Format: ZIP,COUNTRY (e.g., 52726,US or 90210,US)</small>
            </div>
            
            <div class="form-group">
                <label for="location">City/Location (Optional - Used if ZIP not provided)</label>
                <input type="text" 
                       id="location" 
                       name="location" 
                       value="{{ config_location }}"
                       placeholder="Davenport,IA,US">
                <small class="text-secondary">Format: City,State,Country (e.g., Davenport,IA,US or London,GB)</small>
            </div>
            
            <div class="form-group">
                <label for="units">Units</label>
                <select id="units" name="units">
                    <option value="imperial" {% if config_units == "imperial" %}selected{% endif %}>Imperial (°F)</option>
                    <option value="metric" {% if config_units == "metric" %}selected{% endif %}>Metric (°C)</option>
                    <option value="standard" {% if config_units == "standard" %}selected{% endif %}>Standard (K)</option>
                </select>
            </div>
        {% else if plugin.id == "speedtest" %}
            <div class="form-group">
                <label for="min_down">Minimum Download Speed (Mbps)</label>
                <input type="number" 
                       id="min_down" 
                       name="min_down" 
                       value="{{ config_min_down }}"
                       placeholder="100"
                       min="1">
            </div>
            
            <div class="form-group">
                <label for="min_up">Minimum Upload Speed (Mbps)</label>
                <input type="number" 
                       id="min_up" 
                       name="min_up" 
                       value="{{ config_min_up }}"
                       placeholder="20"
                       min="1">
            </div>
        {% else if plugin.id == "docker" %}
            <div class="form-group">
                <label>
                    <input type="checkbox" 
                           id="send_summary" 
                           name="send_summary"
                           {% if config_send_summary %}checked{% endif %}>
                    Send health summaries even when all containers are healthy
                </label>
                <small class="text-secondary">Enable to receive status reports showing container counts and resource usage even when everything is running normally.</small>
            </div>
            
            <div class="form-group">
                <label for="cpu_warn_pct">CPU Warning Threshold (%)</label>
                <input type="number" 
                       id="cpu_warn_pct" 
                       name="cpu_warn_pct" 
                       value="{{ config_cpu_warn_pct }}"
                       placeholder="80.0"
                       min="1"
                       max="100"
                       step="0.1">
                <small class="text-secondary">Alert when container CPU usage exceeds this percentage (default: 80%)</small>
            </div>
            
            <div class="form-group">
                <label for="mem_warn_pct">Memory Warning Threshold (%)</label>
                <input type="number" 
                       id="mem_warn_pct" 
                       name="mem_warn_pct" 
                       value="{{ config_mem_warn_pct }}"
                       placeholder="80.0"
                       min="1"
                       max="100"
                       step="0.1">
                <small class="text-secondary">Alert when container memory usage exceeds this percentage (default: 80%)</small>
            </div>
        {% else if plugin.id == "updates" %}
            <div class="form-group">
                <label>
                    <input type="checkbox" 
                           id="updates_send_summary" 
                           name="updates_send_summary"
                           {% if config_updates_send_summary %}checked{% endif %}>
                    Send status reports even when no updates are available
                </label>
                <small class="text-secondary">Enable to receive "System Up to Date" confirmation messages when checking for updates.</small>
            </div>
        {% else if plugin.id == "health" %}
            <div class="form-group">
                <label>
                    <input type="checkbox" 
                           id="health_send_summary" 
                           name="health_send_summary"
                           {% if config_health_send_summary %}checked{% endif %}>
                    Send health summaries even when all metrics are normal
                </label>
                <small class="text-secondary">Enable to receive status reports showing CPU, memory, and disk usage even when everything is within normal thresholds.</small>
            </div>
            
            <div class="form-group">
                <label for="health_cpu_warn_pct">CPU Warning Threshold (%)</label>
                <input type="number" 
                       id="health_cpu_warn_pct" 
                       name="health_cpu_warn_pct" 
                       value="{{ config_health_cpu_warn_pct }}"
                       placeholder="80.0"
                       min="1"
                       max="100"
                       step="0.1">
                <small class="text-secondary">Alert when system CPU usage exceeds this percentage (default: 80%)</small>
            </div>
            
            <div class="form-group">
                <label for="health_mem_warn_pct">Memory Warning Threshold (%)</label>
                <input type="number" 
                       id="health_mem_warn_pct" 
                       name="health_mem_warn_pct" 
                       value="{{ config_health_mem_warn_pct }}"
                       placeholder="80.0"
                       min="1"
                       max="100"
                       step="0.1">
                <small class="text-secondary">Alert when system memory usage exceeds this percentage (default: 80%)</small>
            </div>
            
            <div class="form-group">
                <label for="health_disk_warn_pct">Disk Warning Threshold (%)</label>
                <input type="number" 
                       id="health_disk_warn_pct" 
                       name="health_disk_warn_pct" 
                       value="{{ config_health_disk_warn_pct }}"
                       placeholder="85.0"
                       min="1"
                       max="100"
                       step="0.1">
                <small class="text-secondary">Alert when disk usage exceeds this percentage (default: 85%)</small>
            </div>
        {% else %}
            <p class="text-secondary">This plugin has no additional configurable options.</p>
        {% endif %}
        
        <div class="flex gap-2">
            <button type="submit" class="btn btn-primary">Save Configuration</button>
            <button type="button" 
                    onclick="document.getElementById('plugin-config-container').innerHTML = ''"
                    class="btn btn-secondary">
                Cancel
            </button>
        </div>
    </form>
</div>

