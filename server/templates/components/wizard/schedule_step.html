<!-- Schedule Step - Choose when to run -->
<div class="card">
    <div class="card-header">
        <h3>When should this job run?</h3>
        <p class="text-secondary" style="margin: 0;">Choose a single run or set up a recurring schedule</p>
    </div>
    <div class="card-body">
        <div class="schedule-options">
            <div class="schedule-option"
                 :class="{ selected: scheduleType === 'now' }"
                 @click="scheduleType = 'now'">
                <i data-lucide="play"></i>
                <h4>Single Job Run</h4>
                <p>Run once upon creation</p>
            </div>

            <div class="schedule-option"
                 :class="{ selected: scheduleType === 'scheduled' }"
                 @click="scheduleType = 'scheduled'">
                <i data-lucide="calendar"></i>
                <h4>Run on Schedule</h4>
                <p>Recurring execution</p>
            </div>
        </div>

        <!-- Schedule Builder -->
        <div x-show="scheduleType === 'scheduled'" x-transition class="mt-4">
            <div class="card" style="background: var(--bg-tertiary);">
                <div class="card-body">
                    <h4 class="mb-3">Schedule Configuration</h4>

                    <div class="form-row" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                        <div class="form-group">
                            <label for="schedule_freq">Frequency</label>
                            <select id="schedule_freq" class="form-select" x-model="scheduleFreq" @change="updateCron()">
                                <option value="hourly">Every Hour</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="custom">Custom Cron</option>
                            </select>
                        </div>

                        <div class="form-group" x-show="scheduleFreq !== 'hourly' && scheduleFreq !== 'custom'">
                            <label for="schedule_time">Time</label>
                            <input type="time" id="schedule_time" class="form-control" x-model="scheduleTime" @change="updateCron()" value="02:00">
                        </div>

                        <div class="form-group" x-show="scheduleFreq === 'weekly'">
                            <label for="schedule_dow">Day of Week</label>
                            <select id="schedule_dow" class="form-select" x-model="scheduleDow" @change="updateCron()">
                                <option value="0">Sunday</option>
                                <option value="1">Monday</option>
                                <option value="2">Tuesday</option>
                                <option value="3">Wednesday</option>
                                <option value="4">Thursday</option>
                                <option value="5">Friday</option>
                                <option value="6">Saturday</option>
                            </select>
                        </div>

                        <div class="form-group" x-show="scheduleFreq === 'monthly'">
                            <label for="schedule_dom">Day of Month</label>
                            <select id="schedule_dom" class="form-select" x-model="scheduleDom" @change="updateCron()">
                                {% for day in 1..=28 %}
                                <option value="{{ day }}">{{ day }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="form-group mt-3" x-show="scheduleFreq === 'custom'">
                        <label for="cron_custom">Cron Expression</label>
                        <input type="text"
                               id="cron_custom"
                               class="form-control"
                               x-model="cronExpression"
                               @input="cronValidation = validateCron(cronExpression)"
                               placeholder="0 30 2 * * *"
                               style="font-family: monospace;"
                               :class="{ 'is-invalid': cronValidation && !cronValidation.valid }">
                        <small class="form-text text-secondary">
                            Format: second minute hour day-of-month month day-of-week<br>
                            Example: <code>0 30 2 * * *</code> = Daily at 2:30 AM
                        </small>
                        <div class="invalid-feedback" x-show="cronValidation && !cronValidation.valid" x-text="cronValidation?.error"></div>
                    </div>

                    <div class="mt-3 p-3" style="background: var(--bg-primary); border-radius: 6px;">
                        <strong class="text-secondary" style="font-size: 0.75rem; text-transform: uppercase;">Cron Expression:</strong>
                        <code style="display: block; margin-top: 0.25rem; font-size: 1rem;" x-text="cronExpression || '0 0 * * * *'"></code>
                        <small class="text-secondary" style="font-size: 0.6875rem; display: block; margin-top: 0.25rem;">
                            sec min hour day month dow
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notification Options -->
        <div class="mt-4">
            <h4 class="mb-3">Notifications</h4>

            <div class="form-row" style="display: flex; gap: 2rem; flex-wrap: wrap;">
                <label class="form-check">
                    <input type="checkbox" class="form-check-input" x-model="notifySuccess">
                    <span class="form-check-label">
                        <i data-lucide="check-circle" style="width: 14px; height: 14px; color: var(--accent-success);"></i>
                        Notify on success
                    </span>
                </label>

                <label class="form-check">
                    <input type="checkbox" class="form-check-input" x-model="notifyFailure">
                    <span class="form-check-label">
                        <i data-lucide="x-circle" style="width: 14px; height: 14px; color: var(--accent-error);"></i>
                        Notify on failure
                    </span>
                </label>
            </div>

            <div class="form-group mt-3" x-show="notifySuccess || notifyFailure">
                <label>Notification Channels</label>
                {% if channels.is_empty() %}
                <div class="alert alert-warning mt-2">
                    <i data-lucide="alert-triangle" style="width: 16px; height: 16px;"></i>
                    No notification channels configured.
                    <a href="/settings/notifications/channels">Add a channel</a> to receive notifications.
                </div>
                {% else %}
                <p class="text-secondary" style="font-size: 0.8125rem; margin: 0.25rem 0 0.75rem 0;">
                    Select one or more channels to receive notifications
                </p>
                <div class="channel-list" style="display: flex; flex-wrap: wrap; gap: 0.75rem;">
                    {% for channel in channels %}
                    <label class="channel-option"
                           style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0.75rem; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 6px; cursor: pointer; transition: all 0.2s;"
                           :style="isChannelSelected({{ channel.id }}) ? 'border-color: var(--accent-color); background: color-mix(in srgb, var(--accent-color) 10%, var(--bg-tertiary))' : ''">
                        <input type="checkbox"
                               :checked="isChannelSelected({{ channel.id }})"
                               @change="toggleChannel({{ channel.id }})"
                               style="margin: 0;">
                        <span>{{ channel.name }}</span>
                        <span class="badge badge-secondary" style="font-size: 0.6875rem;">{{ channel.channel_type }}</span>
                    </label>
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <!-- Notification Preview -->
            <div class="mt-4" x-show="(notifySuccess || notifyFailure) && channelIds.length > 0" x-transition>
                <h5 class="mb-2" style="font-size: 0.875rem; color: var(--text-secondary);">
                    <i data-lucide="eye" style="width: 14px; height: 14px;"></i> Notification Preview
                </h5>
                <div style="display: grid; gap: 0.75rem;">
                    <!-- Success Notification Preview -->
                    <div x-show="notifySuccess" class="notification-preview" style="background: var(--bg-tertiary); border-radius: var(--radius-lg); padding: 0.75rem 1rem; border-left: 3px solid var(--accent-success);">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                            <i data-lucide="check-circle" style="width: 16px; height: 16px; color: var(--accent-success);"></i>
                            <strong style="font-size: 0.875rem;">Job Completed Successfully</strong>
                        </div>
                        <p style="margin: 0; font-size: 0.8125rem; color: var(--text-secondary);">
                            <span x-text="selectedJobName || 'Your Job'"></span> completed on
                            <span x-text="Object.keys(selectedServerNames).length"></span> server(s)
                        </p>
                    </div>
                    <!-- Failure Notification Preview -->
                    <div x-show="notifyFailure" class="notification-preview" style="background: var(--bg-tertiary); border-radius: var(--radius-lg); padding: 0.75rem 1rem; border-left: 3px solid var(--accent-error);">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                            <i data-lucide="alert-circle" style="width: 16px; height: 16px; color: var(--accent-error);"></i>
                            <strong style="font-size: 0.875rem;">Job Failed</strong>
                        </div>
                        <p style="margin: 0; font-size: 0.8125rem; color: var(--text-secondary);">
                            <span x-text="selectedJobName || 'Your Job'"></span> failed with error: [error message]
                        </p>
                    </div>
                    <small class="text-muted" style="font-size: 0.75rem;">
                        <i data-lucide="info" style="width: 12px; height: 12px;"></i>
                        Notifications will be sent to <span x-text="channelIds.length"></span> channel(s) when enabled conditions are met.
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
