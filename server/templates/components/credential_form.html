<div class="card" x-data="{ authType: '{% match credential %}{% when Some with (c) %}{{ c.credential_type }}{% when None %}password{% endmatch %}' }">
    <h2>{% match credential %}{% when Some with (_) %}Edit{% when None %}Add{% endmatch %} Credential</h2>

    {% match error %}
    {% when Some with (e) %}
    <div class="alert alert-error">{{ e }}</div>
    {% when None %}
    {% endmatch %}

    {% match credential %}
    {% when Some with (c) %}
    <form hx-put="/credentials/{{ c.id }}"
          hx-target="#credential-list"
          hx-swap="innerHTML">

        <div class="form-group">
            <label for="name">Credential Name *</label>
            <input type="text"
                   id="name"
                   name="name"
                   value="{{ c.name }}"
                   placeholder="Production SSH Key"
                   required>
            <small class="text-secondary">A descriptive name to identify this credential</small>
        </div>

        <div class="form-group">
            <label for="username">Username *</label>
            <input type="text"
                   id="username"
                   name="username"
                   value="{{ c.username }}"
                   placeholder="ubuntu"
                   required>
        </div>

        <div class="form-group">
            <label for="credential_type">Authentication Type *</label>
            <select id="credential_type"
                    name="credential_type"
                    x-model="authType"
                    required>
                <option value="password">Password</option>
                <option value="ssh_key">SSH Private Key</option>
            </select>
        </div>

        <div class="form-group" x-show="authType === 'password'">
            <label for="password-value">Password</label>
            <input type="password"
                   id="password-value"
                   name="value"
                   autocomplete="new-password"
                   placeholder="Leave blank to keep current password"
                   x-bind:disabled="authType !== 'password'">
            <small class="text-secondary">Password is encrypted at rest</small>
        </div>

        <div class="form-group" x-show="authType === 'ssh_key'">
            <label for="ssh-key-value">SSH Private Key</label>
            <textarea id="ssh-key-value"
                      name="value"
                      rows="8"
                      placeholder="-----BEGIN OPENSSH PRIVATE KEY-----&#10;...&#10;-----END OPENSSH PRIVATE KEY-----&#10;&#10;Leave blank to keep current key"
                      x-bind:disabled="authType !== 'ssh_key'"></textarea>
            <small class="text-secondary">Private key is encrypted at rest</small>
        </div>

        <div class="form-group">
            <label for="description">Description (optional)</label>
            <textarea id="description"
                      name="description"
                      rows="2"
                      placeholder="Brief description of when to use this credential">{{ c.description }}</textarea>
        </div>

        <div class="flex gap-2">
            <button type="submit" class="btn btn-primary">
                <i data-lucide="save" style="width: 16px; height: 16px;"></i> Save
            </button>
            <button type="button"
                    onclick="document.getElementById('credential-form-container').innerHTML = ''"
                    class="btn btn-secondary">
                Cancel
            </button>
        </div>
    </form>
    {% when None %}
    <form hx-post="/credentials"
          hx-target="#credential-list"
          hx-swap="innerHTML">

        <div class="form-group">
            <label for="name">Credential Name *</label>
            <input type="text"
                   id="name"
                   name="name"
                   placeholder="Production SSH Key"
                   required>
            <small class="text-secondary">A descriptive name to identify this credential</small>
        </div>

        <div class="form-group">
            <label for="username">Username *</label>
            <input type="text"
                   id="username"
                   name="username"
                   placeholder="ubuntu"
                   required>
        </div>

        <div class="form-group">
            <label for="credential_type">Authentication Type *</label>
            <select id="credential_type"
                    name="credential_type"
                    x-model="authType"
                    required>
                <option value="password">Password</option>
                <option value="ssh_key">SSH Private Key</option>
            </select>
        </div>

        <div class="form-group" x-show="authType === 'password'">
            <label for="password-value">Password *</label>
            <input type="password"
                   id="password-value"
                   name="value"
                   autocomplete="new-password"
                   :required="authType === 'password'"
                   :disabled="authType !== 'password'">
            <small class="text-secondary">Password is encrypted at rest</small>
        </div>

        <div class="form-group" x-show="authType === 'ssh_key'">
            <label for="ssh-key-value">SSH Private Key *</label>
            <textarea id="ssh-key-value"
                      name="value"
                      rows="8"
                      placeholder="-----BEGIN OPENSSH PRIVATE KEY-----&#10;...&#10;-----END OPENSSH PRIVATE KEY-----"
                      :required="authType === 'ssh_key'"
                      :disabled="authType !== 'ssh_key'"></textarea>
            <small class="text-secondary">Private key is encrypted at rest</small>
        </div>

        <div class="form-group">
            <label for="description">Description (optional)</label>
            <textarea id="description"
                      name="description"
                      rows="2"
                      placeholder="Brief description of when to use this credential"></textarea>
        </div>

        <div class="flex gap-2">
            <button type="submit" class="btn btn-primary">
                <i data-lucide="save" style="width: 16px; height: 16px;"></i> Save
            </button>
            <button type="button"
                    onclick="document.getElementById('credential-form-container').innerHTML = ''"
                    class="btn btn-secondary">
                Cancel
            </button>
        </div>
    </form>
    {% endmatch %}
</div>
