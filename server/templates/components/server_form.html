<div class="card">
    <h2>{% match server %}{% when Some with (_) %}Edit{% when None %}Add{% endmatch %} Server</h2>
    
    {% match error %}
    {% when Some with (e) %}
    <div class="alert alert-error">{{ e }}</div>
    {% when None %}
    {% endmatch %}
    
    {% match server %}
    {% when Some with (s) %}
    <form hx-put="/servers/{{ s.id }}"
          hx-target="#server-list"
          hx-swap="innerHTML">
        
        <div class="form-group">
            <label for="name">Server Name *</label>
            <input type="text" 
                   id="name" 
                   name="name" 
                   value="{{ s.name }}" 
                   required>
        </div>
        
        <div class="form-group">
            <label for="host">Host *</label>
            <input type="text" 
                   id="host" 
                   name="host" 
                   value="{{ s.host }}" 
                   placeholder="192.168.1.100 or example.com"
                   required>
        </div>
        
        <div class="grid grid-2">
            <div class="form-group">
                <label for="port">SSH Port</label>
                <input type="number" 
                       id="port" 
                       name="port" 
                       value="{% match s.port %}{% when Some with (p) %}{{ p }}{% when None %}22{% endmatch %}" 
                       placeholder="22"
                       min="1"
                       max="65535">
            </div>
            
            <div class="form-group">
                <label for="username">SSH Username</label>
                <input type="text" 
                       id="username" 
                       name="username" 
                       value="{% match s.username %}{% when Some with (u) %}{{ u }}{% when None %}{% endmatch %}" 
                       placeholder="ubuntu">
            </div>
        </div>
        
        <div class="form-group">
            <label for="description">Description (optional)</label>
            <textarea id="description" 
                      name="description" 
                      rows="3" 
                      placeholder="Brief description of this server">{% match s.description %}{% when Some with (d) %}{{ d }}{% when None %}{% endmatch %}</textarea>
        </div>
        
        <!-- Test connection result -->
        <div id="test-connection-result"></div>
        
        <div class="flex gap-2">
            <button type="submit" class="btn btn-primary">Save</button>
            <button type="button" 
                    class="btn btn-secondary"
                    hx-post="/servers/test"
                    hx-include="[name='host'], [name='port'], [name='username']"
                    hx-target="#test-connection-result"
                    hx-swap="innerHTML">
                Test Connection
            </button>
            <button type="button" 
                    onclick="document.getElementById('server-form-container').innerHTML = ''"
                    class="btn btn-secondary">
                Cancel
            </button>
        </div>
    </form>
    {% when None %}
    <form hx-post="/servers"
          hx-target="#server-list"
          hx-swap="innerHTML">
        
        <div class="form-group">
            <label for="name">Server Name *</label>
            <input type="text" 
                   id="name" 
                   name="name" 
                   required>
        </div>
        
        <div class="form-group">
            <label for="host">Host *</label>
            <input type="text" 
                   id="host" 
                   name="host" 
                   placeholder="192.168.1.100 or example.com"
                   required>
        </div>
        
        <div class="grid grid-2">
            <div class="form-group">
                <label for="port">SSH Port</label>
                <input type="number" 
                       id="port" 
                       name="port" 
                       value="22" 
                       placeholder="22"
                       min="1"
                       max="65535">
            </div>
            
            <div class="form-group">
                <label for="username">SSH Username</label>
                <input type="text" 
                       id="username" 
                       name="username" 
                       placeholder="ubuntu">
            </div>
        </div>
        
        <div class="form-group">
            <label for="description">Description (optional)</label>
            <textarea id="description" 
                      name="description" 
                      rows="3" 
                      placeholder="Brief description of this server"></textarea>
        </div>
        
        <!-- Test connection result -->
        <div id="test-connection-result"></div>
        
        <div class="flex gap-2">
            <button type="submit" class="btn btn-primary">Save</button>
            <button type="button" 
                    class="btn btn-secondary"
                    hx-post="/servers/test"
                    hx-include="[name='host'], [name='port'], [name='username']"
                    hx-target="#test-connection-result"
                    hx-swap="innerHTML">
                Test Connection
            </button>
            <button type="button" 
                    onclick="document.getElementById('server-form-container').innerHTML = ''"
                    class="btn btn-secondary">
                Cancel
            </button>
        </div>
    </form>
    {% endmatch %}
</div>
