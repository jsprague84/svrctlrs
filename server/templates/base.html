<!DOCTYPE html>
<html lang="en" 
      x-data="{ sidebarOpen: false, theme: localStorage.getItem('theme') || 'dark' }" 
      x-init="$watch('theme', val => localStorage.setItem('theme', val))"
      :data-theme="theme">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}SvrCtlRS{% endblock %}</title>
    
    <!-- Prevent FOUC (Flash of Unstyled Content) - Set theme immediately -->
    <script>
        // Set theme on html element before page renders
        const theme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', theme);
    </script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="/static/css/styles.css">
    
    <!-- Alpine.js for client-side interactivity (NOT deferred - needed immediately) -->
    <script src="/static/js/alpine.min.js"></script>
    
    <!-- HTMX -->
    <script src="/static/js/htmx.min.js"></script>
    
    {% block head %}{% endblock %}
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <!-- Mobile menu button -->
            <button @click="sidebarOpen = !sidebarOpen" class="mobile-menu-btn">
                â˜°
            </button>
            
            <a href="/" class="header-title">SvrCtlRS</a>
            
            <div class="header-spacer"></div>
            
            <!-- Theme toggle -->
            <button @click="theme = theme === 'light' ? 'dark' : 'light'" 
                    class="btn btn-secondary"
                    title="Toggle theme">
                <span x-show="theme === 'light'">ğŸŒ™</span>
                <span x-show="theme === 'dark'">â˜€ï¸</span>
            </button>
            
            {% match user %}
            {% when Some with (u) %}
            <span class="text-secondary">{{ u.username }}</span>
            <form action="/auth/logout" method="post" style="display: inline;">
                <button type="submit" class="btn btn-secondary">Logout</button>
            </form>
            {% when None %}
            <a href="/auth/login" class="btn btn-primary">Login</a>
            {% endmatch %}
        </header>
        
        <div class="main-layout">
            <!-- Sidebar -->
            <aside class="sidebar" :class="{ 'open': sidebarOpen }" @click.away="sidebarOpen = false">
                <nav>
                    <a href="/" class="nav-link {% block nav_dashboard %}{% endblock %}">
                        ğŸ“Š Dashboard
                    </a>
                    <a href="/servers" class="nav-link {% block nav_servers %}{% endblock %}">
                        ğŸ–¥ï¸ Servers
                    </a>
                    <a href="/tasks" class="nav-link {% block nav_tasks %}{% endblock %}">
                        âš™ï¸ Tasks
                    </a>
                    <a href="/plugins" class="nav-link {% block nav_plugins %}{% endblock %}">
                        ğŸ”Œ Plugins
                    </a>
                    <a href="/settings" class="nav-link {% block nav_settings %}{% endblock %}">
                        âš™ï¸ Settings
                    </a>
                </nav>
            </aside>
            
            <!-- Main content -->
            <main class="main-content">
                {% block content %}{% endblock %}
            </main>
        </div>
    </div>
    
    <!-- Toast notifications container -->
    <div id="toast-container" style="position: fixed; top: 80px; right: 20px; z-index: 1000;">
        <!-- Toasts will be injected here via HTMX -->
    </div>
</body>
</html>

